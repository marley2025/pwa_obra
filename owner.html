<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Site App – Owner Panel</title>
  <link rel="stylesheet" href="assets/styles.css"/>
  <script defer src="assets/config.js"></script>
  <script defer src="assets/api.js"></script>
</head>
<body>
  <div class="container">
    <h2>Owner Panel</h2>
    <div class="nav">
      <a href="index.html">Check</a>
      <a href="pedir.html">Request Material</a>
      <a href="owner.html">Owner Panel</a>
    </div>
    <div class="card">
      <button class="btn btn-blue" onclick="load()">Refresh</button>
      <div id="list" class="list"></div>
      <div id="msg" class="small"></div>
    </div>
  </div>
  <script>
    async function load(){
      try{
        const data = await listPending();
        const list = document.getElementById('list'); list.innerHTML = '';
        if(!data || data.length===0){ list.innerHTML = '<div class="small">No pending requests</div>'; return; }
        data.forEach(item=>{
          const div = document.createElement('div'); div.className='card';
          const quote = item.quote_payload ? ('<pre>'+JSON.stringify(item.quote_payload,null,2)+'</pre>') : '';
          div.innerHTML = `
            <b>${item.name}</b> — ${item.product_name} (${item.qty} ${item.uom}) <span class="badge">${item.state}</span><br/>
            Project: ${item.project}<br/>By: ${item.employee}<br/>${quote}
            <div class="row">
              <button class="btn btn-green" onclick="approve(${item.id})">Approve</button>
              <button class="btn btn-blue" onclick="orderB(${item.id})">Order Best</button>
            </div>`;
          list.appendChild(div);
        });
      }catch(e){
        document.getElementById('msg').textContent = '⚠️ '+e.message;
      }
    }
    async function approve(id){ try{ await approveRequest(id); load(); }catch(e){ alert(e.message); } }
    async function orderB(id){ try{ await orderBest(id); load(); }catch(e){ alert(e.message); } }
    load();
  </script>
</body>
</html>
